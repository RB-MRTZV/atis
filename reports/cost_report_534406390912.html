
<!DOCTYPE html>
<html>
<head>
    <title>AWS Cost Estimation Report</title>
    <meta charset="utf-8">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #232f3e;
            color: white;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .metadata {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        .card h3 {
            margin: 0 0 10px 0;
            color: #232f3e;
        }
        .card .amount {
            font-size: 28px;
            font-weight: bold;
            color: #ff9900;
        }
        .card .label {
            color: #666;
            font-size: 14px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        th {
            background-color: #232f3e;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }
        td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .section-title {
            color: #232f3e;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #ff9900;
        }
        .total-row {
            font-weight: bold;
            background-color: #f0f0f0;
        }
        .ec2-managed {
            color: #1e88e5;
        }
        .ec2-ephemeral {
            color: #43a047;
        }
        .charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .chart-container {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .chart-container.small {
            max-width: 350px;
            margin: 0 auto;
        }
        .chart-row {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .filters {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        .filter-group label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #232f3e;
        }
        .filter-group select, .filter-group input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
        }
        .filter-group button {
            padding: 10px 20px;
            background-color: #ff9900;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }
        .filter-group button:hover {
            background-color: #e68900;
        }
        .hidden {
            display: none !important;
        }
        .sortable {
            cursor: pointer;
            position: relative;
        }
        .sortable:hover {
            background-color: #1a252f;
        }
        .sortable::after {
            content: 'â†•';
            position: absolute;
            right: 5px;
            color: #ccc;
        }
        .sort-asc::after {
            content: 'â†‘';
            color: white;
        }
        .sort-desc::after {
            content: 'â†“';
            color: white;
        }
        .savings-calculator {
            background-color: white;
            padding: 25px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border-left: 4px solid #43a047;
        }
        .savings-header {
            color: #232f3e;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .savings-header::before {
            content: 'ðŸ’°';
            font-size: 24px;
        }
        .savings-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .control-group {
            display: flex;
            flex-direction: column;
        }
        .control-group label {
            margin-bottom: 8px;
            font-weight: bold;
            color: #232f3e;
        }
        .control-group select, .control-group input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .time-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
        }
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        .calculate-btn {
            background-color: #43a047;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .calculate-btn:hover {
            background-color: #2e7d32;
        }
        .savings-results {
            display: none;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            margin-top: 20px;
        }
        .savings-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .savings-card {
            background-color: white;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .savings-card h4 {
            margin: 0 0 8px 0;
            color: #232f3e;
            font-size: 14px;
        }
        .savings-card .amount {
            font-size: 20px;
            font-weight: bold;
            color: #43a047;
        }
        .savings-breakdown {
            margin-top: 20px;
        }
        .breakdown-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 4px;
            overflow: hidden;
        }
        .breakdown-table th {
            background-color: #43a047;
            color: white;
            padding: 10px;
            text-align: left;
            font-size: 14px;
        }
        .breakdown-table td {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }
        .breakdown-table tr:hover {
            background-color: #f5f5f5;
        }
        .warning-text {
            color: #e65100;
            font-style: italic;
            font-size: 13px;
            margin-top: 10px;
        }
        .schedule-preview {
            background-color: #e3f2fd;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 13px;
            color: #1565c0;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="header">
        <h1>AWS Cost Estimation Report</h1>
        <p>Account: 534406390912 | Region: ap-southeast-2</p>
        <p>Generated: 2025-06-17 16:19:34 UTC</p>
    </div>
    
    <div class="metadata">
        <h3>Report Information</h3>
        <p><strong>Scan Time:</strong> 2025-06-17T06:19:33.228756</p>
        <p><strong>Currency:</strong> USD</p>
        <p><strong>Pricing Data Updated:</strong> 2025-06-17T16:18:28.879906</p>
    </div>

    <div class="summary-cards">
        <div class="card">
            <h3>Total Monthly Cost</h3>
            <div class="amount">$552.38</div>
            <div class="label">USD per month</div>
        </div>
        <div class="card">
            <h3>Total Daily Cost</h3>
            <div class="amount">$18.41</div>
            <div class="label">USD per day</div>
        </div>
        <div class="card">
            <h3>Total Resources</h3>
            <div class="amount">12</div>
            <div class="label">Active resources</div>
        </div>
    </div>
    
    <!-- Filters Section -->
    <div class="filters">
        <div class="filter-group">
            <label for="serviceFilter">Filter by Service:</label>
            <select id="serviceFilter">
                <option value="all">All Services</option>
                <option value="EC2">EC2</option>
                <option value="RDS">RDS</option>
                <option value="EKS">EKS</option>
            </select>
        </div>
        <div class="filter-group">
            <label for="envFilter">Filter by Environment:</label>
            <select id="envFilter">
                <option value="all">All Environments</option>
            </select>
        </div>
        <div class="filter-group">
            <label for="instanceFilter">Filter by Instance Type:</label>
            <select id="instanceFilter">
                <option value="all">All Instance Types</option>
            </select>
        </div>
        <div class="filter-group">
            <label for="costFilter">Min Monthly Cost ($):</label>
            <input type="number" id="costFilter" min="0" step="0.01" placeholder="0.00">
        </div>
        <div class="filter-group">
            <button onclick="applyFilters()">Apply Filters</button>
        </div>
        <div class="filter-group">
            <button onclick="clearFilters()">Clear Filters</button>
        </div>
    </div>
    
    <!-- Cost Savings Calculator -->
    <div class="savings-calculator">
        <h2 class="savings-header">Cost Savings Calculator</h2>
        <p>Calculate potential savings by automatically stopping instances during off-hours and weekends.</p>
        
        <div class="savings-controls">
            <div class="control-group">
                <label for="savingsScope">Apply Savings To:</label>
                <select id="savingsScope">
                    <option value="all">All Resources</option>
                    <option value="service">Specific Service</option>
                    <option value="environment">Specific Environment</option>
                    <option value="service-environment">Service + Environment</option>
                </select>
            </div>
            
            <div class="control-group" id="serviceSelection" style="display: none;">
                <label for="savingsService">Select Service:</label>
                <select id="savingsService">
                    <option value="EC2">EC2</option>
                    <option value="RDS">RDS</option>
                    <option value="EKS">EKS</option>
                </select>
            </div>
            
            <div class="control-group" id="environmentSelection" style="display: none;">
                <label for="savingsEnvironment">Select Environment:</label>
                <select id="savingsEnvironment">
                </select>
            </div>
            
            <div class="control-group">
                <label>Running Hours (24h format):</label>
                <div class="time-controls">
                    <div>
                        <label for="startTime" style="font-size: 12px; margin-bottom: 4px;">Start Time:</label>
                        <input type="time" id="startTime" value="08:00">
                    </div>
                    <div>
                        <label for="endTime" style="font-size: 12px; margin-bottom: 4px;">End Time:</label>
                        <input type="time" id="endTime" value="19:00">
                    </div>
                </div>
                <div class="schedule-preview" id="schedulePreview">
                    Instances will run from 08:00 to 19:00 (11 hours/day)
                </div>
            </div>
            
            <div class="control-group">
                <label>Weekend Operation:</label>
                <div class="checkbox-group">
                    <input type="checkbox" id="runWeekends">
                    <label for="runWeekends">Run on weekends</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="runSaturday">
                    <label for="runSaturday">Run on Saturday only</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="runSunday">
                    <label for="runSunday">Run on Sunday only</label>
                </div>
            </div>
            
            <div class="control-group">
                <label>&nbsp;</label>
                <button class="calculate-btn" onclick="calculateSavings()">Calculate Savings</button>
            </div>
        </div>
        
        <div class="savings-results" id="savingsResults">
            <div class="savings-summary">
                <div class="savings-card">
                    <h4>Current Monthly Cost</h4>
                    <div class="amount" id="currentCost">$0.00</div>
                </div>
                <div class="savings-card">
                    <h4>Optimized Monthly Cost</h4>
                    <div class="amount" id="optimizedCost">$0.00</div>
                </div>
                <div class="savings-card">
                    <h4>Monthly Savings</h4>
                    <div class="amount" id="monthlySavings">$0.00</div>
                </div>
                <div class="savings-card">
                    <h4>Annual Savings</h4>
                    <div class="amount" id="annualSavings">$0.00</div>
                </div>
                <div class="savings-card">
                    <h4>Savings Percentage</h4>
                    <div class="amount" id="savingsPercentage">0%</div>
                </div>
            </div>
            
            <div class="savings-breakdown">
                <h4>Detailed Breakdown</h4>
                <table class="breakdown-table">
                    <thead>
                        <tr>
                            <th>Service</th>
                            <th>Environment</th>
                            <th>Resources</th>
                            <th>Current Monthly</th>
                            <th>Optimized Monthly</th>
                            <th>Monthly Savings</th>
                            <th>Hours Saved/Week</th>
                        </tr>
                    </thead>
                    <tbody id="breakdownTableBody">
                    </tbody>
                </table>
            </div>
            
            <div class="warning-text">
                * Calculations assume instances can be safely stopped during specified hours.<br>
                * RDS instances may have additional considerations for Multi-AZ deployments.<br>
                * EKS node savings depend on cluster auto-scaling configuration.<br>
                * Always test schedule changes in non-production environments first.
            </div>
        </div>
    </div>

    <div class="chart-row">
        <div class="chart-container small">
            <h3>Cost by Service</h3>
            <canvas id="serviceChart"></canvas>
        </div>
        <div class="chart-container">
            <h3>Cost by Environment</h3>
            <canvas id="envChart"></canvas>
        </div>
    </div>
    
    <div class="charts">
        <div class="chart-container">
            <h3>Top 10 Instance Types by Cost</h3>
            <canvas id="instanceChart"></canvas>
        </div>
        <div class="chart-container">
            <h3>Resource Count by Service</h3>
            <canvas id="resourceChart"></canvas>
        </div>
    </div>

    <h2 class="section-title">Cost Summary by Service and Environment</h2>
    <table id="summaryTable">
        <thead>
            <tr>
                <th class="sortable" onclick="sortTable('summaryTable', 0)">Service</th>
                <th class="sortable" onclick="sortTable('summaryTable', 1)">Environment</th>
                <th class="sortable" onclick="sortTable('summaryTable', 2)">Resource Count</th>
                <th class="sortable" onclick="sortTable('summaryTable', 3)">Daily Cost</th>
                <th class="sortable" onclick="sortTable('summaryTable', 4)">Monthly Cost</th>
            </tr>
        </thead>
        <tbody>

            <tr class="" data-service="EC2" data-environment="unknown" data-monthly-cost="431.42">
                <td>EC2</td>
                <td>unknown</td>
                <td>10</td>
                <td>$14.38</td>
                <td>$431.42</td>
            </tr>

            <tr class="" data-service="RDS" data-environment="unknown" data-monthly-cost="120.96">
                <td>RDS</td>
                <td>unknown</td>
                <td>2</td>
                <td>$4.03</td>
                <td>$120.96</td>
            </tr>

            <tr class="total-row" data-service="TOTAL" data-environment="ALL" data-monthly-cost="552.38">
                <td>TOTAL</td>
                <td>ALL</td>
                <td>12</td>
                <td>$18.41</td>
                <td>$552.38</td>
            </tr>

        </tbody>
    </table>

    <h2 class="section-title">EC2 Instance Details</h2>
    <table id="ec2Table">
        <thead>
            <tr>
                <th class="sortable" onclick="sortTable('ec2Table', 0)">Instance ID</th>
                <th class="sortable" onclick="sortTable('ec2Table', 1)">Instance Type</th>
                <th class="sortable" onclick="sortTable('ec2Table', 2)">Environment</th>
                <th class="sortable" onclick="sortTable('ec2Table', 3)">Type</th>
                <th class="sortable" onclick="sortTable('ec2Table', 4)">In ASG</th>
                <th class="sortable" onclick="sortTable('ec2Table', 5)">ASG Name</th>
                <th class="sortable" onclick="sortTable('ec2Table', 6)">Daily Cost</th>
                <th class="sortable" onclick="sortTable('ec2Table', 7)">Monthly Cost</th>
            </tr>
        </thead>
        <tbody>

            <tr class="detail-row" data-service="EC2" data-environment="unknown" data-instance-type="t2.micro" data-monthly-cost="10.512">
                <td>i-03ad60a02a3f6267c</td>
                <td>t2.micro</td>
                <td>unknown</td>
                <td class="ec2-managed">Managed</td>
                <td>False</td>
                <td>None</td>
                <td>$0.35</td>
                <td>$10.51</td>
            </tr>

            <tr class="detail-row" data-service="EC2" data-environment="unknown" data-instance-type="t2.micro" data-monthly-cost="10.512">
                <td>i-0d1b194cfaaec09ad</td>
                <td>t2.micro</td>
                <td>unknown</td>
                <td class="ec2-managed">Managed</td>
                <td>False</td>
                <td>None</td>
                <td>$0.35</td>
                <td>$10.51</td>
            </tr>

            <tr class="detail-row" data-service="EC2" data-environment="unknown" data-instance-type="t2.medium" data-monthly-cost="42.048">
                <td>i-0773bc163483f0c81</td>
                <td>t2.medium</td>
                <td>unknown</td>
                <td class="ec2-managed">Managed</td>
                <td>False</td>
                <td>None</td>
                <td>$1.40</td>
                <td>$42.05</td>
            </tr>

            <tr class="detail-row" data-service="EC2" data-environment="unknown" data-instance-type="t2.xlarge" data-monthly-cost="168.192">
                <td>i-06d4f6e20e0ce75ff</td>
                <td>t2.xlarge</td>
                <td>unknown</td>
                <td class="ec2-managed">Managed</td>
                <td>False</td>
                <td>None</td>
                <td>$5.61</td>
                <td>$168.19</td>
            </tr>

            <tr class="detail-row" data-service="EC2" data-environment="unknown" data-instance-type="t2.small" data-monthly-cost="21.024">
                <td>i-03d324c2966451b0c</td>
                <td>t2.small</td>
                <td>unknown</td>
                <td class="ec2-managed">Managed</td>
                <td>False</td>
                <td>None</td>
                <td>$0.70</td>
                <td>$21.02</td>
            </tr>

            <tr class="detail-row" data-service="EC2" data-environment="unknown" data-instance-type="t3.large" data-monthly-cost="76.032">
                <td>i-073409690b1333f1b</td>
                <td>t3.large</td>
                <td>unknown</td>
                <td class="ec2-managed">Managed</td>
                <td>False</td>
                <td>None</td>
                <td>$2.53</td>
                <td>$76.03</td>
            </tr>

            <tr class="detail-row" data-service="EC2" data-environment="unknown" data-instance-type="t3.small" data-monthly-cost="19.008">
                <td>i-0dbe6ae5e21d053a9</td>
                <td>t3.small</td>
                <td>unknown</td>
                <td class="ec2-managed">Managed</td>
                <td>False</td>
                <td>None</td>
                <td>$0.63</td>
                <td>$19.01</td>
            </tr>

            <tr class="detail-row" data-service="EC2" data-environment="unknown" data-instance-type="t2.small" data-monthly-cost="21.024">
                <td>i-004f01a439f80ab66</td>
                <td>t2.small</td>
                <td>unknown</td>
                <td class="ec2-managed">Managed</td>
                <td>False</td>
                <td>None</td>
                <td>$0.70</td>
                <td>$21.02</td>
            </tr>

            <tr class="detail-row" data-service="EC2" data-environment="unknown" data-instance-type="t2.medium" data-monthly-cost="42.048">
                <td>i-0509dcd40a6d931ab</td>
                <td>t2.medium</td>
                <td>unknown</td>
                <td class="ec2-managed">Managed</td>
                <td>False</td>
                <td>None</td>
                <td>$1.40</td>
                <td>$42.05</td>
            </tr>

            <tr class="detail-row" data-service="EC2" data-environment="unknown" data-instance-type="t2.small" data-monthly-cost="21.024">
                <td>i-00b5d66eb38457366</td>
                <td>t2.small</td>
                <td>unknown</td>
                <td class="ec2-managed">Managed</td>
                <td>False</td>
                <td>None</td>
                <td>$0.70</td>
                <td>$21.02</td>
            </tr>

        </tbody>
    </table>

    <h2 class="section-title">RDS Instance Details</h2>
    <table id="rdsTable">
        <thead>
            <tr>
                <th class="sortable" onclick="sortTable('rdsTable', 0)">Instance ID</th>
                <th class="sortable" onclick="sortTable('rdsTable', 1)">Instance Class</th>
                <th class="sortable" onclick="sortTable('rdsTable', 2)">Environment</th>
                <th class="sortable" onclick="sortTable('rdsTable', 3)">Engine</th>
                <th class="sortable" onclick="sortTable('rdsTable', 4)">Multi-AZ</th>
                <th class="sortable" onclick="sortTable('rdsTable', 5)">Storage Type</th>
                <th class="sortable" onclick="sortTable('rdsTable', 6)">Daily Cost</th>
                <th class="sortable" onclick="sortTable('rdsTable', 7)">Monthly Cost</th>
            </tr>
        </thead>
        <tbody>

            <tr class="detail-row" data-service="RDS" data-environment="unknown" data-instance-type="db.t3.medium" data-monthly-cost="80.64">
                <td>maindb</td>
                <td>db.t3.medium</td>
                <td>unknown</td>
                <td>postgres</td>
                <td>False</td>
                <td>gp2</td>
                <td>$2.69</td>
                <td>$80.64</td>
            </tr>

            <tr class="detail-row" data-service="RDS" data-environment="unknown" data-instance-type="db.t3.small" data-monthly-cost="40.32">
                <td>urm-production</td>
                <td>db.t3.small</td>
                <td>unknown</td>
                <td>postgres</td>
                <td>False</td>
                <td>gp3</td>
                <td>$1.34</td>
                <td>$40.32</td>
            </tr>

        </tbody>
    </table>

    <script>
        // Populate filter dropdowns
        document.addEventListener('DOMContentLoaded', function() {
            const envFilter = document.getElementById('envFilter');
            const instanceFilter = document.getElementById('instanceFilter');
            
            // Add environment options
            ['unknown'].forEach(env => {
                const option = document.createElement('option');
                option.value = env;
                option.textContent = env;
                envFilter.appendChild(option);
            });
            
            // Add instance type options
            ['db.t3.medium', 'db.t3.small', 't2.medium', 't2.micro', 't2.small', 't2.xlarge', 't3.large', 't3.small'].forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                instanceFilter.appendChild(option);
            });
        });
        
        // Filtering functions
        function applyFilters() {
            const serviceFilter = document.getElementById('serviceFilter').value;
            const envFilter = document.getElementById('envFilter').value;
            const instanceFilter = document.getElementById('instanceFilter').value;
            const costFilter = parseFloat(document.getElementById('costFilter').value) || 0;
            
            // Filter summary table
            const summaryRows = document.querySelectorAll('#summaryTable tbody tr');
            summaryRows.forEach(row => {
                const service = row.getAttribute('data-service');
                const environment = row.getAttribute('data-environment');
                const monthlyCost = parseFloat(row.getAttribute('data-monthly-cost'));
                
                let show = true;
                if (serviceFilter !== 'all' && service !== serviceFilter) show = false;
                if (envFilter !== 'all' && environment !== envFilter) show = false;
                if (monthlyCost < costFilter) show = false;
                
                row.style.display = show ? '' : 'none';
            });
            
            // Filter detail tables
            const detailRows = document.querySelectorAll('.detail-row');
            detailRows.forEach(row => {
                const service = row.getAttribute('data-service');
                const environment = row.getAttribute('data-environment');
                const instanceType = row.getAttribute('data-instance-type');
                const monthlyCost = parseFloat(row.getAttribute('data-monthly-cost'));
                
                let show = true;
                if (serviceFilter !== 'all' && service !== serviceFilter) show = false;
                if (envFilter !== 'all' && environment !== envFilter) show = false;
                if (instanceFilter !== 'all' && instanceType !== instanceFilter) show = false;
                if (monthlyCost < costFilter) show = false;
                
                row.style.display = show ? '' : 'none';
            });
            
            // Filter EKS clusters
            const eksClusterRows = document.querySelectorAll('.eks-cluster-row');
            eksClusterRows.forEach(row => {
                const service = row.getAttribute('data-service');
                const environment = row.getAttribute('data-environment');
                const instanceType = row.getAttribute('data-instance-type');
                const monthlyCost = parseFloat(row.getAttribute('data-monthly-cost'));
                
                let show = true;
                if (serviceFilter !== 'all' && service !== serviceFilter) show = false;
                if (envFilter !== 'all' && environment !== envFilter) show = false;
                if (instanceFilter !== 'all' && instanceType !== instanceFilter) show = false;
                if (monthlyCost < costFilter) show = false;
                
                row.style.display = show ? '' : 'none';
                
                // Hide entire cluster div if no rows visible
                const clusterDiv = row.closest('div[style*="border"]');
                if (clusterDiv) {
                    const visibleRows = clusterDiv.querySelectorAll('.eks-cluster-row:not([style*="display: none"])');
                    clusterDiv.style.display = visibleRows.length > 0 ? '' : 'none';
                }
            });
        }
        
        function clearFilters() {
            document.getElementById('serviceFilter').value = 'all';
            document.getElementById('envFilter').value = 'all';
            document.getElementById('instanceFilter').value = 'all';
            document.getElementById('costFilter').value = '';
            
            // Show all rows
            const allRows = document.querySelectorAll('tr, div[style*="border"]');
            allRows.forEach(row => {
                row.style.display = '';
            });
        }
        
        // Sorting functions
        let sortDirection = {};
        
        function sortTable(tableId, columnIndex) {
            const table = document.getElementById(tableId);
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            const isNumeric = columnIndex >= 6; // Cost columns are numeric
            
            const sortKey = tableId + '_' + columnIndex;
            const ascending = !sortDirection[sortKey];
            sortDirection[sortKey] = ascending;
            
            // Update header appearance
            const headers = table.querySelectorAll('th.sortable');
            headers.forEach(header => {
                header.classList.remove('sort-asc', 'sort-desc');
            });
            
            const currentHeader = headers[columnIndex];
            currentHeader.classList.add(ascending ? 'sort-asc' : 'sort-desc');
            
            rows.sort((a, b) => {
                const aValue = a.cells[columnIndex].textContent.trim();
                const bValue = b.cells[columnIndex].textContent.trim();
                
                let aVal, bVal;
                if (isNumeric) {
                    aVal = parseFloat(aValue.replace(/[$,]/g, '')) || 0;
                    bVal = parseFloat(bValue.replace(/[$,]/g, '')) || 0;
                } else {
                    aVal = aValue.toLowerCase();
                    bVal = bValue.toLowerCase();
                }
                
                if (aVal < bVal) return ascending ? -1 : 1;
                if (aVal > bVal) return ascending ? 1 : -1;
                return 0;
            });
            
            // Reorder rows
            rows.forEach(row => tbody.appendChild(row));
        }
        
        // Cost Savings Calculator Functions
        const detailedResourceData = [{'service': 'EC2', 'resource_id': 'i-03ad60a02a3f6267c', 'instance_type': 't2.micro', 'environment': 'unknown', 'type': 'Managed', 'in_asg': False, 'asg_name': None, 'hourly_cost': 0.0146, 'daily_cost': 0.3504, 'monthly_cost': 10.512, 'currency': 'USD'}, {'service': 'EC2', 'resource_id': 'i-0d1b194cfaaec09ad', 'instance_type': 't2.micro', 'environment': 'unknown', 'type': 'Managed', 'in_asg': False, 'asg_name': None, 'hourly_cost': 0.0146, 'daily_cost': 0.3504, 'monthly_cost': 10.512, 'currency': 'USD'}, {'service': 'EC2', 'resource_id': 'i-0773bc163483f0c81', 'instance_type': 't2.medium', 'environment': 'unknown', 'type': 'Managed', 'in_asg': False, 'asg_name': None, 'hourly_cost': 0.0584, 'daily_cost': 1.4016, 'monthly_cost': 42.048, 'currency': 'USD'}, {'service': 'EC2', 'resource_id': 'i-06d4f6e20e0ce75ff', 'instance_type': 't2.xlarge', 'environment': 'unknown', 'type': 'Managed', 'in_asg': False, 'asg_name': None, 'hourly_cost': 0.2336, 'daily_cost': 5.6064, 'monthly_cost': 168.192, 'currency': 'USD'}, {'service': 'EC2', 'resource_id': 'i-03d324c2966451b0c', 'instance_type': 't2.small', 'environment': 'unknown', 'type': 'Managed', 'in_asg': False, 'asg_name': None, 'hourly_cost': 0.0292, 'daily_cost': 0.7008, 'monthly_cost': 21.024, 'currency': 'USD'}, {'service': 'EC2', 'resource_id': 'i-073409690b1333f1b', 'instance_type': 't3.large', 'environment': 'unknown', 'type': 'Managed', 'in_asg': False, 'asg_name': None, 'hourly_cost': 0.1056, 'daily_cost': 2.5343999999999998, 'monthly_cost': 76.032, 'currency': 'USD'}, {'service': 'EC2', 'resource_id': 'i-0dbe6ae5e21d053a9', 'instance_type': 't3.small', 'environment': 'unknown', 'type': 'Managed', 'in_asg': False, 'asg_name': None, 'hourly_cost': 0.0264, 'daily_cost': 0.6335999999999999, 'monthly_cost': 19.008, 'currency': 'USD'}, {'service': 'EC2', 'resource_id': 'i-004f01a439f80ab66', 'instance_type': 't2.small', 'environment': 'unknown', 'type': 'Managed', 'in_asg': False, 'asg_name': None, 'hourly_cost': 0.0292, 'daily_cost': 0.7008, 'monthly_cost': 21.024, 'currency': 'USD'}, {'service': 'EC2', 'resource_id': 'i-0509dcd40a6d931ab', 'instance_type': 't2.medium', 'environment': 'unknown', 'type': 'Managed', 'in_asg': False, 'asg_name': None, 'hourly_cost': 0.0584, 'daily_cost': 1.4016, 'monthly_cost': 42.048, 'currency': 'USD'}, {'service': 'EC2', 'resource_id': 'i-00b5d66eb38457366', 'instance_type': 't2.small', 'environment': 'unknown', 'type': 'Managed', 'in_asg': False, 'asg_name': None, 'hourly_cost': 0.0292, 'daily_cost': 0.7008, 'monthly_cost': 21.024, 'currency': 'USD'}, {'service': 'RDS', 'resource_id': 'maindb', 'instance_type': 'db.t3.medium', 'environment': 'unknown', 'engine': 'postgres', 'multi_az': False, 'storage_type': 'gp2', 'hourly_cost': 0.112, 'daily_cost': 2.688, 'monthly_cost': 80.64, 'currency': 'USD'}, {'service': 'RDS', 'resource_id': 'urm-production', 'instance_type': 'db.t3.small', 'environment': 'unknown', 'engine': 'postgres', 'multi_az': False, 'storage_type': 'gp3', 'hourly_cost': 0.056, 'daily_cost': 1.344, 'monthly_cost': 40.32, 'currency': 'USD'}];
        
        // Initialize savings calculator
        document.addEventListener('DOMContentLoaded', function() {
            // Populate environment dropdown for savings calculator
            const savingsEnvSelect = document.getElementById('savingsEnvironment');
            ['unknown'].forEach(env => {
                const option = document.createElement('option');
                option.value = env;
                option.textContent = env;
                savingsEnvSelect.appendChild(option);
            });
            
            // Setup event listeners for savings calculator
            document.getElementById('savingsScope').addEventListener('change', updateSavingsScope);
            document.getElementById('startTime').addEventListener('change', updateSchedulePreview);
            document.getElementById('endTime').addEventListener('change', updateSchedulePreview);
            document.getElementById('runWeekends').addEventListener('change', updateWeekendControls);
            document.getElementById('runSaturday').addEventListener('change', updateWeekendControls);
            document.getElementById('runSunday').addEventListener('change', updateWeekendControls);
            
            updateSchedulePreview();
        });
        
        function updateSavingsScope() {
            const scope = document.getElementById('savingsScope').value;
            const serviceSelection = document.getElementById('serviceSelection');
            const environmentSelection = document.getElementById('environmentSelection');
            
            serviceSelection.style.display = (scope === 'service' || scope === 'service-environment') ? 'block' : 'none';
            environmentSelection.style.display = (scope === 'environment' || scope === 'service-environment') ? 'block' : 'none';
        }
        
        function updateSchedulePreview() {
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const preview = document.getElementById('schedulePreview');
            
            if (startTime && endTime) {
                const start = new Date('2000-01-01 ' + startTime);
                const end = new Date('2000-01-01 ' + endTime);
                let hours = (end - start) / (1000 * 60 * 60);
                
                if (hours < 0) {
                    hours += 24; // Handle overnight schedules
                }
                
                preview.textContent = `Instances will run from ${startTime} to ${endTime} (${hours} hours/day)`;
            }
        }
        
        function updateWeekendControls() {
            const runWeekends = document.getElementById('runWeekends');
            const runSaturday = document.getElementById('runSaturday');
            const runSunday = document.getElementById('runSunday');
            
            if (runWeekends.checked) {
                runSaturday.checked = false;
                runSunday.checked = false;
                runSaturday.disabled = true;
                runSunday.disabled = true;
            } else {
                runSaturday.disabled = false;
                runSunday.disabled = false;
            }
        }
        
        function calculateSavings() {
            const scope = document.getElementById('savingsScope').value;
            const service = document.getElementById('savingsService').value;
            const environment = document.getElementById('savingsEnvironment').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const runWeekends = document.getElementById('runWeekends').checked;
            const runSaturday = document.getElementById('runSaturday').checked;
            const runSunday = document.getElementById('runSunday').checked;
            
            if (!startTime || !endTime) {
                alert('Please specify both start and end times.');
                return;
            }
            
            // Calculate daily running hours
            const start = new Date('2000-01-01 ' + startTime);
            const end = new Date('2000-01-01 ' + endTime);
            let dailyRunningHours = (end - start) / (1000 * 60 * 60);
            if (dailyRunningHours < 0) {
                dailyRunningHours += 24; // Handle overnight schedules
            }
            
            // Calculate weekly schedule
            let weekdayHours = dailyRunningHours * 5; // Monday to Friday
            let weekendHours = 0;
            
            if (runWeekends) {
                weekendHours = dailyRunningHours * 2; // Both Saturday and Sunday
            } else {
                if (runSaturday) weekendHours += dailyRunningHours;
                if (runSunday) weekendHours += dailyRunningHours;
            }
            
            const totalWeeklyHours = weekdayHours + weekendHours;
            const hoursStoppedPerWeek = 168 - totalWeeklyHours; // 168 hours in a week
            const utilizationRatio = totalWeeklyHours / 168;
            
            // Filter resources based on scope
            let filteredResources = detailedResourceData.filter(resource => {
                if (scope === 'service') {
                    return resource.service === service;
                } else if (scope === 'environment') {
                    return resource.environment === environment;
                } else if (scope === 'service-environment') {
                    return resource.service === service && resource.environment === environment;
                }
                return true; // 'all' scope
            });
            
            // Calculate savings
            let totalCurrentCost = 0;
            let totalOptimizedCost = 0;
            const breakdownData = {};
            
            filteredResources.forEach(resource => {
                const key = `${resource.service}_${resource.environment}`;
                
                if (!breakdownData[key]) {
                    breakdownData[key] = {
                        service: resource.service,
                        environment: resource.environment,
                        resourceCount: 0,
                        currentMonthlyCost: 0,
                        optimizedMonthlyCost: 0
                    };
                }
                
                breakdownData[key].resourceCount++;
                breakdownData[key].currentMonthlyCost += resource.monthly_cost;
                
                // Calculate optimized cost based on utilization ratio
                const optimizedCost = resource.monthly_cost * utilizationRatio;
                breakdownData[key].optimizedMonthlyCost += optimizedCost;
                
                totalCurrentCost += resource.monthly_cost;
                totalOptimizedCost += optimizedCost;
            });
            
            const totalSavings = totalCurrentCost - totalOptimizedCost;
            const savingsPercentage = totalCurrentCost > 0 ? (totalSavings / totalCurrentCost * 100) : 0;
            const annualSavings = totalSavings * 12;
            
            // Update results display
            document.getElementById('currentCost').textContent = `$${totalCurrentCost.toFixed(2)}`;
            document.getElementById('optimizedCost').textContent = `$${totalOptimizedCost.toFixed(2)}`;
            document.getElementById('monthlySavings').textContent = `$${totalSavings.toFixed(2)}`;
            document.getElementById('annualSavings').textContent = `$${annualSavings.toFixed(2)}`;
            document.getElementById('savingsPercentage').textContent = `${savingsPercentage.toFixed(1)}%`;
            
            // Update breakdown table
            const tableBody = document.getElementById('breakdownTableBody');
            tableBody.innerHTML = '';
            
            Object.values(breakdownData).forEach(data => {
                const row = tableBody.insertRow();
                const savings = data.currentMonthlyCost - data.optimizedMonthlyCost;
                
                row.innerHTML = `
                    <td>${data.service}</td>
                    <td>${data.environment}</td>
                    <td>${data.resourceCount}</td>
                    <td>$${data.currentMonthlyCost.toFixed(2)}</td>
                    <td>$${data.optimizedMonthlyCost.toFixed(2)}</td>
                    <td style="color: #43a047; font-weight: bold;">$${savings.toFixed(2)}</td>
                    <td>${hoursStoppedPerWeek.toFixed(1)} hrs</td>
                `;
            });
            
            // Show results
            document.getElementById('savingsResults').style.display = 'block';
            
            // Scroll to results
            document.getElementById('savingsResults').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Service Chart (smaller pie chart)
        const serviceCtx = document.getElementById('serviceChart').getContext('2d');
        new Chart(serviceCtx, {
            type: 'doughnut',
            data: {
                labels: ['EC2', 'RDS'],
                datasets: [{
                    data: [431.42, 120.96],
                    backgroundColor: ['#ff9900', '#232f3e', '#146eb4', '#43a047', '#e53935']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 10,
                            usePointStyle: true
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': $' + context.parsed.toFixed(2);
                            }
                        }
                    }
                }
            }
        });
        
        // Environment Chart
        const envCtx = document.getElementById('envChart').getContext('2d');
        new Chart(envCtx, {
            type: 'bar',
            data: {
                labels: ['unknown'],
                datasets: [{
                    label: 'Monthly Cost',
                    data: [552.38],
                    backgroundColor: '#ff9900',
                    borderColor: '#e68900',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + value.toFixed(2);
                            }
                        }
                    }
                }
            }
        });
        
        // Instance Types Chart
        const instanceCtx = document.getElementById('instanceChart').getContext('2d');
        new Chart(instanceCtx, {
            type: 'bar',
            data: {
                labels: ['t2.xlarge', 't2.medium', 'db.t3.medium', 't3.large', 't2.small', 'db.t3.small', 't2.micro', 't3.small'],
                datasets: [{
                    label: 'Monthly Cost',
                    data: [168.192, 84.096, 80.64, 76.032, 63.072, 40.32, 21.024, 19.008],
                    backgroundColor: '#146eb4',
                    borderColor: '#0d47a1',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                indexAxis: 'y',
                scales: {
                    x: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + value.toFixed(2);
                            }
                        }
                    }
                }
            }
        });
        
        // Resource Count Chart
        const resourceCtx = document.getElementById('resourceChart').getContext('2d');
        new Chart(resourceCtx, {
            type: 'bar',
            data: {
                labels: ['EC2', 'RDS'],
                datasets: [{
                    label: 'Resource Count',
                    data: [10, 2],
                    backgroundColor: '#43a047',
                    borderColor: '#2e7d32',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
